## point_map_yandex_fastapi_project

- Вход: JSON со списком точек `{id, latitude, longitude, title?}`
- Скрипт создаёт публичную карту с метками через веб-автоматизацию и отдаёт ссылку

### Задача
- **Вход**: JSON с точками `[{id, latitude, longitude, title?}, ...]`
- **Выход**: публичная карта Яндекса или коллекция с метками, видимая в другой сессии/на другом устройстве (через общий URL или в аккаунте).

### Подходы (оба реализованы)
- **Map Constructor (официальный конструктор карт)**: создаёт публичную карту и возвращает ссылку. Видно всем по ссылке, без авторизации.
- **Коллекции в аккаунте**: добавляет точки в коллекцию авторизованного пользователя, можно поделиться ссылкой на коллекцию. Видно на всех устройствах при входе в аккаунт; по ссылке — всем.

### Быстрый старт
1) Установите Python 3.12+ и создайте окружение (доступен консольный скрипт `yandex-markers` при установке проекта):
```
python3 -m venv .venv
. .venv/bin/activate
pip install -U pip
pip install -e .
python -m playwright install chromium
```

2) Проверьте входные данные:
```
yandex-markers to_geojson samples/points.json
```

3a) Опубликовать карту через Конструктор:
```
yandex-markers constructor samples/points.json --title "Демо точки" --headless False
```
На выходе получите URL опубликованной карты. Откройте на другом устройстве/в другом браузере — метки видны.

3б) Добавить в Коллекции (нужны cookie авторизованной сессии):
- В браузере откройте `yandex.ru`, войдите.
- В DevTools Application/Storage экспортируйте cookies в JSON (см. `samples/cookies.sample.json`).
```
yandex-markers collections samples/points.json cookies.json --collection-name "Демо коллекция" --headless False
```
Скрипт распечатает ссылку на коллекцию. Откройте на другом устройстве (вошли в аккаунт — появится в Коллекциях; либо по ссылке).

### Формат входа
`samples/points.json`:
```
[
  {"id": "p1", "latitude": 55.751244, "longitude": 37.618423, "title": "Москва"},
  {"id": "p2", "latitude": 59.938732, "longitude": 30.316229, "title": "СПб"}
]
```

### Ключевые файлы
- `main.py` — модели `Point`, валидация, экспорт в GeoJSON
- `cli.py` — команды: `to_geojson`, `constructor`, `collections`
- `automation/constructor.py` — автоматизация Конструктора карт (публикация, ссылка)
- `automation/collections.py` — автоматизация Коллекций (создание, шаринг)

### Обработка ошибок (кратко)
- Валидация входа через Pydantic (диапазоны широты/долготы, пустые заголовки).
- Веб-автоматизация использует несколько селекторов и таймаутов; при провале шаг пропускается, продолжается выполнение.
- Явное сообщение об ошибках в формате CLI exit code 1, читаемые trace/log.

### Доказательство видимости
- Конструктор: откройте напечатанную ссылку в инкогнито/на другом устройстве.
- Коллекции: откройте ссылку коллекции или зайдите в аккаунт на другом устройстве и откройте `Коллекции`.

### Примечания
- UI Яндекс.Карт меняется; селекторы в Playwright подобраны с запасом (несколько вариантов, русские/роле-селекторы).
- При необходимости используйте `--headless False` для наглядности и скриншотов.